<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Kas Universe | Multi Temp Mail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #00f5a0;
      --secondary: #38bdf8;
      --bg: #020617;
      --card: rgba(30,41,59,0.85);
    }

    body {
      margin: 0;
      font-family: "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top, #020617, #000);
      color: white;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      text-align: center;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .controls {
      max-width: 600px;
      margin: auto;
      text-align: center;
      margin-bottom: 20px;
    }

    .controls button {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-weight: 700;
      cursor: pointer;
      color: #020617;
      box-shadow: 0 10px 25px rgba(0,245,160,.3);
    }

    .emails {
      max-width: 900px;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .mail-card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 20px 50px rgba(0,0,0,.6);
      border: 1px solid rgba(255,255,255,.08);
    }

    .mail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .mail-header span {
      font-weight: 700;
      font-size: 0.9rem;
      color: #a7f3d0;
    }

    .mail-address {
      font-size: 0.9rem;
      word-break: break-all;
      margin-bottom: 10px;
      color: #f1f5f9;
    }

    .mail-actions button {
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 0.75rem;
      cursor: pointer;
      background: rgba(255,255,255,.1);
      color: white;
      margin-right: 6px;
    }

    .mail-actions button:hover {
      background: rgba(255,255,255,.2);
    }

    .msg-list {
      max-height: 180px;
      overflow-y: auto;
    }

    .msg {
      background: rgba(255,255,255,.05);
      border-left: 3px solid var(--primary);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .msg:hover {
      background: rgba(255,255,255,.12);
    }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal-content {
      background: rgba(30,41,59,.9);
      width: 100%;
      max-width: 500px;
      border-radius: 18px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,.1);
    }

    .modal-header {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 10px;
    }

    .modal-body {
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .modal-content button {
      margin-top: 15px;
      width: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 10px;
      padding: 10px;
      font-weight: 700;
      cursor: pointer;
      color: #020617;
    }
  </style>
</head>
<body>

<h1>ðŸ“§ KAS UNIVERSE â€” MULTI TEMP MAIL</h1>

<div class="controls">
  <button onclick="generateMultiple()">âœ¨ GÃ©nÃ©rer 10 Emails</button>
</div>

<div id="emails" class="emails"></div>

<!-- MODAL -->
<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="modalFrom" class="modal-header"></div>
    <div id="modalBody" class="modal-body"></div>
    <button onclick="closeModal()">Fermer</button>
  </div>
</div>

<script>
const MAX = 10;
let mailboxes = [];

async function generateMultiple() {
  document.getElementById("emails").innerHTML = "";
  mailboxes = [];
  for (let i = 1; i <= MAX; i++) {
    await createMailbox(i);
  }
}

async function createMailbox(index) {
  const domainRes = await fetch("https://api.mail.tm/domains");
  const domainData = await domainRes.json();
  const domain = domainData["hydra:member"][0].domain;

  const random = Math.random().toString(36).substring(2, 10);
  const email = `${random}@${domain}`;
  const password = "password123";

  await fetch("https://api.mail.tm/accounts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ address: email, password })
  });

  const tokenRes = await fetch("https://api.mail.tm/token", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ address: email, password })
  });
  const tokenData = await tokenRes.json();

  const mailbox = {
    index,
    email,
    token: tokenData.token,
    messages: []
  };

  mailboxes.push(mailbox);
  renderMailbox(mailbox);
  setInterval(() => loadMessages(mailbox), 6000);
}

function renderMailbox(box) {
  const container = document.getElementById("emails");

  const card = document.createElement("div");
  card.className = "mail-card";
  card.id = `mail-${box.index}`;

  card.innerHTML = `
    <div class="mail-header">
      <span>ðŸ“® Gmail ${box.index}</span>
    </div>
    <div class="mail-address">${box.email}</div>
    <div class="mail-actions">
      <button onclick="copyEmail('${box.email}')">ðŸ“‹ Copier</button>
      <button onclick="loadMessagesByIndex(${box.index})">ðŸ”„ Actualiser</button>
    </div>
    <div class="msg-list" id="msgs-${box.index}">
      <div style="color:#94a3b8;font-size:0.8rem;">Aucun message...</div>
    </div>
  `;

  container.appendChild(card);
}

async function loadMessagesByIndex(i) {
  const box = mailboxes.find(m => m.index === i);
  if (box) loadMessages(box);
}

async function loadMessages(box) {
  const res = await fetch("https://api.mail.tm/messages", {
    headers: { Authorization: `Bearer ${box.token}` }
  });
  const data = await res.json();
  const list = document.getElementById(`msgs-${box.index}`);
  list.innerHTML = "";

  const msgs = data["hydra:member"];
  if (!msgs || msgs.length === 0) {
    list.innerHTML = `<div style="color:#94a3b8;font-size:0.8rem;">Aucun message...</div>`;
    return;
  }

  msgs.forEach(msg => {
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<strong>${msg.from.address}</strong><br>${msg.subject || "(Sans sujet)"}`;
    div.onclick = () => readMessage(box.token, msg.id, msg.from.address);
    list.appendChild(div);
  });
}

async function readMessage(token, id, from) {
  const res = await fetch(`https://api.mail.tm/messages/${id}`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const data = await res.json();
  document.getElementById("modalFrom").innerText = "De : " + from;
  document.getElementById("modalBody").innerText = data.text || data.html || "Message vide";
  document.getElementById("modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("modal").style.display = "none";
}

function copyEmail(email) {
  navigator.clipboard.writeText(email);
  alert("CopiÃ© : " + email);
}
</script>

</body>
</html>
